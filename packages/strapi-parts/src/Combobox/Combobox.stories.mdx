<!--- Combobox.stories.mdx --->

import { useState, useRef } from 'react';
import { Meta, Story, Canvas } from '@storybook/addon-docs/blocks';
import { Combobox, CreatableCombobox, AsyncCombobox } from './Combobox';
import { ComboboxOption } from './ComboboxOption'

<Meta title="Design System/Molecules/Combobox" component={Combobox} />

# Combobox

This is the doc of the `Combobox` component

<Canvas>
  <Story name="base">
    {() => {
      const [value, setValue] = useState('');
      return  <Combobox
                label="Food"
                value={value}
                onChange={setValue}>
                <ComboboxOption value="hamburger">Hamburger</ComboboxOption>
                <ComboboxOption value="bagel">Bagel</ComboboxOption>
                <ComboboxOption value="tartuffo">Tartuffo</ComboboxOption>
                <ComboboxOption value="carbonara">Carbonara</ComboboxOption>
              </Combobox>;
    }}
  </Story>
</Canvas>

# Disabled

This is the doc of the `Combobox` component

<Canvas>
  <Story name="disabled">
    {() => {
      const [value, setValue] = useState('');
      return  <Combobox
                label="Food"
                disabled
                value={value}
                onChange={setValue}>
                <ComboboxOption value="hamburger">Hamburger</ComboboxOption>
                <ComboboxOption value="bagel">Bagel</ComboboxOption>
                <ComboboxOption value="tartuffo">Tartuffo</ComboboxOption>
                <ComboboxOption value="carbonara">Carbonara</ComboboxOption>
              </Combobox>;
    }}
  </Story>
</Canvas>

# Error

This is the doc of the `Combobox` component

<Canvas>
  <Story name="error">
    {() => {
      const [value, setValue] = useState('');
      return  <Combobox
                label="Food"
                value={value}
                error="An error occured"
                onChange={setValue}>
                <ComboboxOption value="hamburger">Hamburger</ComboboxOption>
                <ComboboxOption value="bagel">Bagel</ComboboxOption>
                <ComboboxOption value="tartuffo">Tartuffo</ComboboxOption>
                <ComboboxOption value="carbonara">Carbonara</ComboboxOption>
              </Combobox>;
    }}
  </Story>
</Canvas>

# Creatable

This is the doc of the `Combobox` component

<Canvas>
  <Story name="creatable">
    {() => {
      const [value, setValue] = useState('');
      const [options, setOptions] = useState([
        {
          name: 'Hamburger',
          value: 'hamburger',
        },
        {
          name: 'Sandwich',
          value: 'sandwich',
        },
        {
          name: 'Peperroni',
          value: 'peperroni',
        },
        {
          name: 'Asparagus',
          value: 'asparagus',
        },
        {
          name: 'Lettuce',
          value: 'lettuce',
        },
        {
          name: 'Tomato',
          value: 'tomato',
        },
        {
          name: 'Bagel',
          value: 'bagel',
        },
        {
          name: 'Tartuffo',
          value: 'tartuffo',
        },
        {
          name: 'Carbonara',
          value: 'carbonara',
        },
      ]);
      const onCreateOption = (value) => {
        setOptions((opt) => [...opt, { name: value, value }]);
        setValue(value);
      };
      return (
        <CreatableCombobox
          label="Food"
          value={value}
          onChange={setValue}
          onCreateOption={onCreateOption}
        >
          {
            options.map(({ name, value }) => 
              <ComboboxOption key={value} value={value}>{name}</ComboboxOption>)
          }
        </CreatableCombobox>
      );
    }}
  </Story>
</Canvas>

# Async loading + ∞ scrolling

This is the doc of the `Combobox` component

<Canvas>
  <Story name="async-loading">
    {() => {
      const [value, setValue] = useState('');
      const defaultOptions = [
        {
          name: 'Hamburger',
          value: 'hamburger',
        },
        {
          name: 'Sandwich',
          value: 'sandwich',
        },
        {
          name: 'Peperroni',
          value: 'peperroni',
        },
        {
          name: 'Asparagus',
          value: 'asparagus',
        },
        {
          name: 'Lettuce',
          value: 'lettuce',
        },
        {
          name: 'Tomato',
          value: 'tomato',
        },
        {
          name: 'Bagel',
          value: 'bagel',
        },
        {
          name: 'Tartuffo',
          value: 'tartuffo',
        },
        {
          name: 'Carbonara',
          value: 'carbonara',
        },
      ];
      const [options, setOptions] = useState(defaultOptions);
      const i = useRef(0)
      const [hasMoreItems, setHasMoreItems] = useState(true)
      const onSearchOption = (inputValue) => {
        if (!inputValue) {
          return new Promise(resolve => {
            setTimeout(() => {
              setOptions(defaultOptions)
              resolve()
            }, 700)
          })
        }
        return new Promise(resolve => {
          setTimeout(() => {
            setOptions(defaultOptions.filter(v => v.name.toLowerCase().includes(inputValue.toLowerCase())))
            resolve()
          }, 700)
        })
      }
      const loadMore = () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            setOptions(opts => [...opts, ...defaultOptions.map(v => ({ name: v.name + i.current, value: v.value + i.current}))])
            if (i.current === 2) {
              setHasMoreItems(false);
            }
            i.current++;
            resolve();
          }, 2000);
        });
      }
      return (
        <AsyncCombobox
          label="Food"
          value={value}
          onChange={setValue}
          hasMoreItems={hasMoreItems}
          onLoadMore={loadMore}
          onSearchOption={onSearchOption}
        >
          {
            options.map(({ name, value }) => 
              <ComboboxOption key={value} value={value}>{name}</ComboboxOption>)
          }
        </AsyncCombobox>
      );
    }}
  </Story>
</Canvas>
